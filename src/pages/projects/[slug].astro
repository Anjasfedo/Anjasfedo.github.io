---
import Layout from "../../layouts/Layout.astro";
import { ProjectDetail } from "../../components/project-detail-page/project-detail";
import { getCollection, render } from "astro:content";
import type {
  ProjectStatus,
  ProjectTag,
} from "@/components/projects-page/projects-page";

// Generate static paths for all projects
export async function getStaticPaths() {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    // Use project.id or project.slug.
    // project.id often looks like 'filename.mdoc'
    params: { slug: project.slug || project.id.replace(".mdoc", "") },
    props: { project },
  }));
}

// Get the project from props (returned by getStaticPaths)
const { project } = Astro.props;
const { Content } = await render(project);

// Set page metadata
const title = `${project.data.title} | Project | M. Anjasfedo Afridiansah`;
const keywords = [
  project.data.title,
  ...project.data.tags,
  "anjasfedo projects",
  "web development",
  "mobile development",
  "software engineer portfolio",
  "bengkulu developer",
].join(", ");

// Use project image if available, otherwise use default
const image =
  project.data.image || "https://anjasfedo.github.io/profile-circle.webp";
---

<Layout title={title} keywords={keywords} image={image} showNav={false}>
  <div
    class="relative min-h-screen w-full bg-white dark:bg-neutral-950 transition-colors duration-300 overflow-hidden"
  >
    {/* Grid Background */}
    <div
      class="absolute inset-0 [background-size:20px_20px] [background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)] dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]"
    >
    </div>
    {/* Radial gradient for the container to give a faded look */}
    <div
      class="pointer-events-none absolute inset-0 flex items-center justify-center bg-white [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)] dark:bg-neutral-950 transition-colors duration-300"
    >
    </div>

    <div class="relative z-10">
      <ProjectDetail
        client:load
        project={{
          id: project.id,
          slug: project.slug || project.id.replace(".mdoc", ""),
          title: project.data.title,
          description: project.data.description,
          status: project.data.status as ProjectStatus[],
          tags: project.data.tags as ProjectTag[],
          images: project.data.images,
        }}
      />

      <!-- Render MDX content below the project details -->
      <div class="bg-white dark:bg-neutral-950 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-6 py-4">
          <div
            class="prose text-neutral-600 dark:text-neutral-400 prose-lg prose-neutral dark:prose-invert max-w-none prose-headings:font-bold prose-p:leading-relaxed prose-img:rounded-xl"
          >
            <Content />
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
