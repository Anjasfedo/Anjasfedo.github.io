---
import "../styles/global.css";
import { FloatingDockWrapper } from "../components/shared/floating-dock-wrapper";
import { Footer } from "../components/shared/footer";
import { ThemeLanguageToggle } from "../components/shared/theme-language-toggle";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  keywords?: string;
  noindex?: boolean;
  ogType?: string;
}

const {
  title = "M. Anjasfedo Afridiansah | Software Engineer & ML Enthusiast",
  description = "M. Anjasfedo Afridiansah (Anjasfedo / Anjas / Fedo) is a Software Engineer based in Bengkulu specializing in Web, Mobile, and Machine Learning. Building scalable software and intelligent digital experiences.",
  image = "https://anjasfedo.github.io/profile-circle.webp",
  keywords = "anjasfedo, anjas, fedo, bengkulu, website developer, web developer, mobile developer, software engineer, developer, machine learning, anjasfedo bengkulu, informatics unib, open to project, freelance developer",
  noindex = false,
  ogType = "website",
} = Astro.props;

const url = "https://anjasfedo.github.io";
const currentPath = Astro.url.pathname;
const fullUrl = `${url}${currentPath}`;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Centralize navigation logic here in Astro (Server Side)

const navigationItems = [
  {
    title: t("nav.about"),
    icon: "IconUser", // Just a string
    href: `/${lang}/`,
  },
  {
    title: t("nav.projects"),
    icon: "IconCode",
    href: `/${lang}/projects`,
  },
  {
    title: t("nav.certificates"),
    icon: "IconAward",
    href: `/${lang}/certificates`,
  },
  // {
  //   title: t("nav.experience"),
  //   icon: "IconBriefcase",
  //   href: `/${lang}/#experience`,
  // },
  // {
  //   title: t("nav.services"),
  //   icon: "IconTerminal2",
  //   href: `/${lang}/#services`,
  // },
  {
    title: t("nav.uses"),
    icon: "IconDeviceDesktop",
    href: `/${lang}/uses`,
  },
];
---

<!doctype html>
<html lang={lang} dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <link rel="icon" type="image/webp" href="/profile-circle.webp" />
    <link rel="apple-touch-icon" href="/profile-circle.webp" />

    <!-- Primary SEO Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="M. Anjasfedo Afridiansah" />
    <meta name="robots" content={noindex ? "noindex, nofollow" : "index, follow"} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={fullUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:locale" content={lang === "id" ? "id_ID" : "en_US"} />
    <meta property="og:site_name" content="M. Anjasfedo Afridiansah Portfolio" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={fullUrl} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={image} />

    <!-- Canonical URL -->
    <link rel="canonical" href={fullUrl} />

    <!-- Alternate Language Links -->
    {lang === "en" && (
      <>
        <link rel="alternate" hreflang="en" href={`${url}/en/${currentPath.replace("/en/", "").replace("/id/", "")}`} />
        <link rel="alternate" hreflang="id" href={`${url}/id/${currentPath.replace("/en/", "").replace("/id/", "")}`} />
      </>
    )}
    {lang === "id" && (
      <>
        <link rel="alternate" hreflang="en" href={`${url}/en/${currentPath.replace("/en/", "").replace("/id/", "")}`} />
        <link rel="alternate" hreflang="id" href={`${url}/id/${currentPath.replace("/en/", "").replace("/id/", "")}`} />
      </>
    )}
    <link rel="alternate" hreflang="x-default" href={`${url}/en/${currentPath.replace("/en/", "").replace("/id/", "")}`} />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "M. Anjasfedo Afridiansah",
        "alternateName": ["Anjasfedo", "Anjas", "Fedo"],
        "url": "https://anjasfedo.github.io",
        "image": "https://anjasfedo.github.io/profile-circle.webp",
        "jobTitle": "Software Engineer",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Bengkulu",
          "addressCountry": "ID"
        },
        "description": "Software Engineer based in Bengkulu with expertise in Machine Learning, Full-Stack Web, and Mobile development.",
        "sameAs": [
          "https://github.com/anjasfedo",
          "https://linkedin.com/in/anjasfedo"
        ],
        "knowsAbout": [
          "Web Development",
          "Mobile Development",
          "Machine Learning",
          "Software Engineering",
          "Go",
          "Laravel",
          "React",
          "Python"
        ]
      }
    </script>

    <script is:inline>
      const getTheme = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      };

      const theme = getTheme();

      if (theme === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <meta name="generator" content={Astro.generator} />
  </head>
  <body>
    <FloatingDockWrapper client:load items={navigationItems} />
    <ThemeLanguageToggle client:load />

    <slot />

    <Footer client:visible lang={lang} />
  </body>
</html>
